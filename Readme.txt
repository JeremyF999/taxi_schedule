# 出租车调度-强化学习

## 0数据集

空间上，城市模拟为二维正方形，时间上模拟6：00-24：00一天的1080分钟。以每分钟为最小单位，每分钟随机产生一些需求乘客，乘客信息包含（乘客ID，产生时间，最长等待时间，产生位置x，产生位置y，目标位置x，目标位置y）每分钟随机让一些出租车在地点上班，出租车信息包含（出租车ID，开始上班时间，上班位置x，上班位置y）。
已模拟产生这样的一份数据集“data_small.txt"，数据集不会再改变。

数据集解释：前1080行代表每分钟产生乘客需求，后1080行代表每分钟上岗的出租车。例如第一行的第一个0代表乘客，第二个0代表时间，后面的每一个逗号之间代表每个乘客：序号，最长等待时间，起点x，起点y，终点x，终点y。第1081行的第一个1代表出租车，第二个0代表时间，后面的每一个逗号之间代表每个出租车：序号，上岗位置x，上岗位置y。

## 1数学模型

### 1.1目标

1. 最大化出租车总收益
2. 最小化乘客总等待时间

多目标问题，求解出pareto解集，供人为评判最终姐

### 1.2主要数学符号（代码中的主要变量）

1. 时间（分钟为单位）：当前时间，总时间=1080分钟

   每平方公里密集程度

2. 乘客：ID，出现时间，最长等待时间，出现位置x，出现位置y，目标位置x，目标位置y，当前位置x，当前位置y，当前状态（未出现、等待、已上车、已放弃乘车），已等待时间

3. 出租车：ID，出现时间，出现位置x，出现位置y，当前状态（未上班，等待，自由移动，载客中，已下班），当前总收益

   所有出租车当前总收益

所有乘客总等待时间
出租车平均速度
其他辅助变量不在列举

### 1.3主要约束条件

每平方公里出租车的密集程度不能高于阈值
乘客超出最大等待时间则放弃乘车，相应的总乘客等待时间会变多
出租车司机连续工作，且工作时间不超过8小时
最短行程1公里，最长行程8公里
以每平方公里划分区域

## 2模型转化为MDP

考虑到现在的大城市真实出租车和乘客情况，所有出租车和所有乘客需求均可成功到达后台。强化学习算法站在“上帝视角”可以看到所有乘客信息和出租车信息，属于完全可观测马尔可夫决策过程。算法实现在每分钟执行一个具体的决策以最大化奖励（尽可能达到最优求解目标）。

### 2.1状态

状态信息包含1.2中几乎所有内容，所有乘客信息，所有出租车信息。

### 2.2动作

动作0：默认动作。出租车总是前往附近最近乘客，并搭载。
动作1：所有空闲出租车前往1公里以内最近所需乘客，并完成其需求
动作2：所有空闲出如果满足概率，朝附近更密集的区域行驶
动作3：所有空闲出租车随机朝附近的另一个区域行驶
动作4：前一半处于更密集区域的出租车5min内不搭载乘客，随机向附近非密集区域行驶
动作5：前一半处于更不密集区域的出租车5min内不搭载乘客，随机向附近更密集区域行驶

如果执行动作后，不满足约束条件，终止训练。

### 2.3奖励

每一步执行后，获取即将取得的收入和等待时间。复合为一条奖励。详见代码。

## 3算法和训练

算法已完成，训练等MDP的代码调完bug即可开始。
